<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ì—°ë½ì²˜ ìƒì„¸</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
<div class="edit-container">
  <form class="edit-form" onsubmit="return false;">
    
    <!-- âœ… ìƒë‹¨ ë²„íŠ¼ ì˜ì—­ (ë’¤ë¡œê°€ê¸° / ì‚­ì œ / ìˆ˜ì •) -->
    <div class="button-group">
      <div class="left-buttons">
        <button type="button" class="back-btn">
          <img src="img/back.png" alt="ë’¤ë¡œ ê°€ê¸°" />
        </button>
      </div>
      <div class="right-buttons">
        <button type="button" class="delete-btn">
          <img src="img/delet.png" alt="ì‚­ì œ" />
        </button>
        <button type="button" class="edit-btn">
          <img src="img/edit.png" alt="ìˆ˜ì •" />
        </button>
      </div>
    </div>

    <!-- âœ… í”„ë¡œí•„ ì´ë¯¸ì§€ í‘œì‹œ -->
    <div class="photo-section">
      <img src="img/person1.png" alt="í”„ë¡œí•„ ì´ë¯¸ì§€" class="profile-img" />
    </div>

    <!-- âœ… ì—°ë½ì²˜ ê¸°ë³¸ ì •ë³´ (ì´ë¦„, ì „í™”ë²ˆí˜¸, ì´ë©”ì¼) -->
    <label for="name">ğŸ‘¤ì´ë¦„</label>
    <input type="text" id="name" name="name" disabled />

    <label for="phone">ğŸ“ì „í™”ë²ˆí˜¸</label>
    <input type="tel" id="phone" name="phone" disabled />

    <label for="email">ğŸ“©ì´ë©”ì¼</label>
    <input type="email" id="email" name="email" disabled />

    <!-- âœ… ì¶”ê°€ ì •ë³´ ì˜ì—­ (íƒœê·¸, ìˆ˜ì •ì¼, ì¦ê²¨ì°¾ê¸° ì—¬ë¶€) -->
    <div class="extra-info">
      <span class="contact-tag"></span>
      <span class="contact-updated"></span>
      <span class="contact-favorite"></span>
    </div>
  </form>
</div>

<script>
document.addEventListener('DOMContentLoaded', () => {
  // âœ… URLì—ì„œ edit íŒŒë¼ë¯¸í„° ì¶”ì¶œ
  const editIndex = parseInt(new URLSearchParams(window.location.search).get('edit'), 10);
  let contacts = [];

  // âœ… ì„œë²„ì—ì„œ ì—°ë½ì²˜ ë°ì´í„° ë¡œë“œ
  fetch('/api/contacts')
    .then(res => res.json())
    .then(data => {
      contacts = data;

      // âœ… ìœ íš¨í•œ indexì¼ ê²½ìš° í•´ë‹¹ ì—°ë½ì²˜ ì •ë³´ í‘œì‹œ
      if (!isNaN(editIndex) && contacts.length > editIndex) {
        const contact = contacts[editIndex];
        document.querySelector('#name').value = contact.name || '';
        document.querySelector('#phone').value = contact.phone || '';
        document.querySelector('#email').value = contact.email || '';
        document.querySelector('.contact-tag').innerHTML =  `<p>ğŸ“Œ ë¶„ë¥˜: ${contact.tag || 'ê¸°íƒ€'}</p>`;
        document.querySelector('.contact-updated').innerHTML = `â±ï¸ ë§ˆì§€ë§‰ ìˆ˜ì •ì¼: ${new Date(contact.lastUpdated).toLocaleString()}`;
        document.querySelector('.contact-favorite').textContent = contact.favorite ? 'â˜… ì¦ê²¨ì°¾ê¸°' : '';
        if (contact.image) {
          document.querySelector('.profile-img').src = contact.image;
        }
      }
    })
    .catch(err => {
      console.error('ì—°ë½ì²˜ ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨:', err);
      alert('ì—°ë½ì²˜ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
    });

  // âœ… ë’¤ë¡œê°€ê¸° ë²„íŠ¼ ë™ì‘
  document.querySelector('.back-btn').addEventListener('click', () => {
    window.location.href = 'index.html';
  });

  // âœ… ì‚­ì œ ë²„íŠ¼ ë™ì‘
  document.querySelector('.delete-btn').addEventListener('click', () => {
    if (confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
      fetch(`/api/contacts/${editIndex}`, {
        method: 'DELETE'
      })
        .then(() => {
          alert('ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
          window.location.href = 'index.html';
        })
        .catch(err => {
          alert('ì‚­ì œ ì‹¤íŒ¨: ' + err.message);
        });
    }
  });

  // âœ… ìˆ˜ì • ë²„íŠ¼ í´ë¦­ ì‹œ í¸ì§‘ í˜ì´ì§€ë¡œ ì´ë™
  document.querySelector('.edit-btn').addEventListener('click', () => {
    window.location.href = `sub.html?edit=${editIndex}`;
  });
});
</script>
</body>
</html>
